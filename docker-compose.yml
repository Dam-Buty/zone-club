services:
  sveltekit:
    build: ./app
    container_name: zone-app
    environment:
      - DATABASE_PATH=/data/zone.db
      - DOMAIN=${DOMAIN}
      - SUBDOMAIN=${SUBDOMAIN}
      - STORAGE_SUBDOMAIN=${STORAGE_SUBDOMAIN}
      - RADARR_VO_URL=http://radarr-vo:7878
      - RADARR_VO_API_KEY=${RADARR_VO_API_KEY}
      - RADARR_VF_URL=http://radarr-vf:7878
      - RADARR_VF_API_KEY=${RADARR_VF_API_KEY}
      - TMDB_API_KEY=${TMDB_API_KEY}
      - HMAC_SECRET=${HMAC_SECRET}
    volumes:
      - db_data:/data
      - /data/zone-club/films-vo:/media/films-vo:ro
      - /data/zone-club/films-vf:/media/films-vf:ro
      - media_public:/media/public:rw
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.zone-app.rule=Host(`${SUBDOMAIN}.${DOMAIN}`)"
      - "traefik.http.routers.zone-app.entrypoints=websecure"
      - "traefik.http.routers.zone-app.tls.certresolver=letsencrypt"
      - "traefik.http.services.zone-app.loadbalancer.server.port=3000"
    depends_on:
      - radarr-vo
      - radarr-vf

  lighttpd:
    image: sebp/lighttpd
    container_name: zone-storage
    volumes:
      - /data/zone-club/films-vo:/media/films-vo:ro
      - /data/zone-club/films-vf:/media/films-vf:ro
      - media_public:/media/public:ro
      - ./lighttpd.conf:/etc/lighttpd/lighttpd.conf:ro
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.zone-storage.rule=Host(`${STORAGE_SUBDOMAIN}.${DOMAIN}`)"
      - "traefik.http.routers.zone-storage.entrypoints=websecure"
      - "traefik.http.services.zone-storage.loadbalancer.server.port=80"

  radarr-vo:
    image: linuxserver/radarr:latest
    container_name: zone-radarr-vo
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Paris
    volumes:
      - ./radarr-vo-config:/config
      - /data/zone-club/films-vo:/movies
      - ${SABNZBD_DOWNLOADS}:/downloads
    ports:
      - "7878:7878"
    extra_hosts:
      - "host.docker.internal:host-gateway"

  radarr-vf:
    image: linuxserver/radarr:latest
    container_name: zone-radarr-vf
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Paris
    volumes:
      - ./radarr-vf-config:/config
      - /data/zone-club/films-vf:/movies
      - ${SABNZBD_DOWNLOADS}:/downloads
    ports:
      - "7879:7878"
    extra_hosts:
      - "host.docker.internal:host-gateway"

  bazarr:
    image: linuxserver/bazarr:latest
    container_name: zone-bazarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Paris
    volumes:
      - ./bazarr-config:/config
      - /data/zone-club/films-vo:/movies-vo
      - /data/zone-club/films-vf:/movies-vf
    ports:
      - "6767:6767"

volumes:
  db_data:
  media_public:
